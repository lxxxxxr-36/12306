# 12306官网复刻需求报告（PRD）

## 文档信息
- 产品名称：12306官网复刻项目
- 版本：v1.0
- 日期：2025-10-19
- 文档类型：需求报告/PRD

## 1. 项目概述与范围
- 目标：在Web端完整复刻12306官网核心能力：注册/登录、车票查询与预订、订单与退改签、支付、个人中心、信息查询与客服、候补购票、会员积分等。
- 范围：PC网页为主，移动网页适配；APP另行规划。
- 原则：实名制购票、票务库存真实、峰值高并发可用、安全合规、可观测、可运维。

## 2. 核心功能模块与需求拆解
### 2.1 用户账户与登录
- 登录方式：用户名/手机号/邮箱 + 密码；支持验证码；风控场景下触发滑块/图形验证码；记住用户名；忘记密码/注册入口。
- 注册与实名认证：手机号注册、短信验证；姓名+身份证号实名校验；支持添加乘车人（本人/亲友）。
- 安全：HTTPS全站、密码加密传输（TLS+前端不可逆算法+后端BCrypt/Scrypt存储）；登录失败次数限制、设备指纹与IP限流、黑名单与风险评分。
- 会话与登录态：Token+Cookie双态；有效期30分钟不操作自动退出；支持“保持登录”。

### 2.2 车票查询与筛选
- 查询条件：出发地/到达地/出发日期；是否学生票；是否只看高铁动车；中转/联程（可选）。
- 结果展示：车次、出发/到达时间、历时、席别（商务/一等/二等/硬座/硬卧/软卧/无座等）、票价、余票、购票按钮。
- 筛选/排序：发车时间段、车次类型（G/D/Z/T/K）、席别、是否直达、价格升降、仅显示有票。
- 性能：查询接口≤2s；缓存热门线路；实时库存读取+降级机制。

### 2.3 下单与锁票
- 流程：选择车次与席别→添加乘车人→确认订单→锁票（占座）→支付。
- 乘车人规则：单次最多5人；需实名通过；儿童票/学生票规则校验。
- 锁票规则：支付时限（如15分钟）；超时自动释放；并发冲突采取乐观锁+队列顺序化。
- 座位分配：同车厢优先、靠窗/过道偏好；不可满足时给出提示。

### 2.4 候补购票（无票场景）
- 提交候补：选择目标车次与席别、可接受时间段；冻结候补资金或预授权。
- 成功回填：一旦放票或退票产生库存，系统按规则撮合；成功后通知并自动扣款出票。
- 规则：公平队列、同一用户按提交时间排序；失败解冻资金。

### 2.5 订单中心与退改签
- 订单列表：未支付/已支付/已出票/已完成/已取消/候补中；支持时间、车次筛选。
- 订单详情：车次、乘车人、座位、票价、交易流水、发票/报销凭证。
- 改签：同线路同席别、差价结算；锁票与库存校验；改签失败回退原订单。
- 退票：按铁路退票规则计算手续费；原路退款；部分乘车人退票支持。
- 发票：支持增值税电子发票申请与下载。

### 2.6 支付结算
- 支付渠道：支付宝、微信、银联云闪付、银行卡；支持二维码/跳转支付。
- 安全与对账：支付状态异步回调、幂等校验、签名验签、对账日报；重复支付防护。
- 超时与失败：支付超时关闭订单并释放座位；失败重试与切换渠道。

### 2.7 个人中心与会员
- 资料管理：头像、联系方式、收件地址；安全设置（密码、手机号绑定）。
- 乘车人管理：新增/编辑/删除；与证件类型校验。
- 会员积分：乘车积分累计与兑换（如餐饮/特产/站内服务）；积分规则与清零机制。
- 消息通知：站内信、短信、邮箱；重要事件（锁票、支付、退改签、候补成功）。

### 2.8 信息查询与客服
- 车站服务：进出站指引、换乘、行李、餐饮；公告与停运信息。
- 出行指南：购票政策、学生票、军人票、儿童票规则。
- 信息检索：时刻表、票价查询、运行区间、正晚点（如接入官方接口）。
- 客服：在线工单、常见问题、服务时间提示。

## 3. 关键业务流程
- 登录：输入凭据→风控校验→登录态下发→跳转首页/来源页。
- 查询购票：选择条件→拉取余票→筛选车次→下单锁票→支付→出票→消息通知。
- 候补购票：提交候补→排队撮合→成功扣款出票/失败解冻。
- 退改签：发起→规则校验→计算费用→锁定新票或退票→更新订单与通知。

## 4. 安全与合规
- 传输层：全站HTTPS；HSTS；TLS1.2+。
- 数据层：密码哈希（BCrypt/Scrypt）、敏感字段脱敏与加密（AES）；最小化存取。
- 风控：登录限流、IP与设备指纹、失败阈值锁定、WAF/防爬虫、验证码自适应难度。
- 业务安全：库存扣减幂等、订单状态机、支付签名验签、防重复提交。
- 合规：隐私政策、用户授权、等保合规、日志留存与审计。

## 5. 性能与高可用
- 目标SLA：99.95%（核心购票）
- 峰值并发：查询≥100k QPS、下单≥10k QPS；春运期间支持弹性扩容。
- 响应：首页≤3s、查询≤2s、下单≤2s、支付确认≤5s。
- 架构手段：读写分离、Redis缓存、席位库存内存化与消息队列、异步化与削峰、限流/降级/熔断、灰度发布与蓝绿切换、跨地域容灾RPO≤5min。

## 6. 兼容性与易用性
- 浏览器：Chrome≥80、Firefox≥78、Edge≥88、Safari≥12、IE11（基础功能）。
- 设备：PC优先，移动端响应式（≥360px）；触摸优化；Retina图。
- 适配：分辨率≥1024×768；断网重试与离线提示；无障碍（键盘可达、ARIA标签）。

## 7. 数据模型（核心实体）
- 用户(User)：id、login_name、mobile、email、password_hash、status。
- 乘车人(Passenger)：id、user_id、name、id_type、id_no、type。
- 车次(Train)：code、date、origin、destination、depart_time、arrive_time、duration、type。
- 库存(Inventory)：train_code、date、seat_type、remain、version。
- 订单(Order)：id、user_id、train_code、passengers、seat_type、amount、status。
- 支付(Payment)：order_id、channel、trade_no、status、notify_time。
- 候补(Waitlist)：id、user_id、intent、amount_freeze、status、priority。

## 8. 接口与集成（示例）
- GET /api/trains?origin=&dest=&date=&filters=...
- POST /api/orders (下单锁票)
- POST /api/payments (创建支付)；POST /api/payments/notify (渠道回调)
- POST /api/orders/refund；POST /api/orders/reschedule
- POST /api/waitlist；GET /api/waitlist/{id}

## 9. UI与交互要点
- 首页：顶部导航（车票、会员、站车服务、出行指南、信息查询），中部搜索框，右侧登录入口与扫码APP。
- 登录页：两栏布局（宣传图+登录表单）；用户名/手机号/邮箱输入、密码输入及显示切换、验证码、记住用户名、注册/忘记密码链接；错误即时提示。
- 查询结果页：条件回显、筛选条、车次列表、席别与余票列、购票按钮；无票显示候补入口。
- 订单中心：列表与详情页；退改签入口清晰与规则说明。

### 9.1 “我的12306”与个人中心导航（新增）
- 顶部导航在“欢迎，{username}”左侧新增“我的12306”入口，悬停展示15项：
  - 火车票订单（/my/orders/train）
  - 候补订单（/my/orders/waitlist）
  - 计次·定期票订单（/my/orders/timescard）
  - 约号订单（/my/orders/appointment）
  - 雪具快运订单（/my/orders/ski）
  - 电子发票（/my/orders/invoice）
  - 本人车票（/my/ticket）
  - 我的餐饮·特产（/my/orders/food）
  - 我的保险（/my/orders/insurance）
  - 我的会员（/member）
  - 查看个人信息（/my/profile/view）
  - 账户安全（/my/profile/security）
  - 乘车人（/my/common/passengers）
  - 地址管理（/my/common/addresses）
  - 温馨服务查询（/my/service/query）
- 未登录点击：跳转登录页，登录成功后重定向到来源路径（上述对应路由）。
- 已登录点击：直接跳转到对应页面。
- 直接点击“我的12306”：跳转到个人中心首页（/my）。

### 9.2 个人中心页面结构（新增）
- 布局：左侧树状指引栏 + 右侧内容区域；左侧主分支标题加粗。
- 主分支与路由：
  - 个人中心（/my，主分支标题可点击，直接进入）
  - 订单中心（不可点击主分支，下设8项）：
    - 火车票订单（/my/orders/train）
    - 候补订单（/my/orders/waitlist）
    - 计次·定期票订单（/my/orders/timescard）
    - 约号订单（/my/orders/appointment）
    - 雪具快运订单（/my/orders/ski）
    - 餐饮·特产（/my/orders/food）
    - 保险订单（/my/orders/insurance）
    - 电子发票（/my/orders/invoice）
  - 本人车票（/my/ticket，主分支标题可点击，直接进入）
  - 会员中心（主分支标题可点击，打开独立页面 /member）
  - 个人信息（主分支不可直接点击，下设4项）：
    - 查看个人信息（/my/profile/view）
    - 账号安全（/my/profile/security）
    - 手机核验（/my/profile/mobile）
    - 账号注销（/my/profile/delete）
  - 常用信息管理（主分支不可直接点击，下设2项）：
    - 乘车人（/my/common/passengers）
    - 地址管理（/my/common/addresses）
  - 温馨服务（主分支不可直接点击，下设3项）：
    - 重点旅客预约（/my/service/priority）
    - 遗失物品查找（/my/service/lost）
    - 服务查询（/my/service/query）
- 内容区域初版占位：进入任一页面展示“这是XX页面”，后续按模块填充真实功能。

### 9.3 路由与登录态（新增）
- 受保护路由：/my/* 与 /member 需登录访问；未登录重定向到 /login，并携带来源路径 state.from。
- 登录成功后返回来源路径；若无来源则返回首页。
- 组件位置：
  - 顶部入口组件：src/components/My12306Menu.tsx
  - 个人中心容器：src/pages/my/PersonalCenter.tsx（含侧边栏与内部路由）
  - 会员中心占位：src/pages/my/MemberCenter.tsx
  - 各子页面占位：src/pages/my/sections/*

### 9.5 忘记密码验证码展示（新增）
- 交互：输入账号后发送验证码，前端不显示验证码内容。
- 开发模式：将验证码通过本地开发服务器中间件输出到终端（运行 `npm run dev` 的控制台）。
- 实现：前端向 `POST /__dev/log-code` 发送账号与验证码；Vite 插件在终端打印日志。
- 生产模式：不发送该日志接口，验证码由真实短信/邮件通道下发（后续集成）。

### 9.4 验收要点（新增）
- 悬停菜单显示15项，鼠标点击各项在登录/未登录两种场景均行为正确。
- 左侧树状结构分组与加粗样式符合描述；点击各分支右侧展示占位内容。
- “会员中心”从个人中心左侧点击后打开独立页面路由。
- 浏览器后退/前进在个人中心各子页工作正常。

## 10. 运维与可观测
- 指标：QPS、RT、错误率、库存命中率、支付成功率；SLO与告警阈值。
- 日志：访问、业务、风控、审计；敏感信息脱敏。
- 发布：CI/CD、自动化测试、回滚预案；节假日冻结策略。

## 11. 里程碑与验收
- M1 原型与需求冻结；M2 核心查询与下单；M3 支付与订单中心；M4 候补与退改签；M5 安全与性能优化；M6 上线与压测验收。
- 验收：功能用例通过率≥98%，性能与SLA达标，安全扫描0高危。

---
该报告为复刻12306官网核心能力的需求蓝图，可作为架构设计、前后端开发与测试的依据。